<!DOCTYPE html>
<!--
  ~ Copyright (c) 2017. Lorem ipsum dolor sit amet, consectetur adipiscing elit.
  ~ Morbi non lorem porttitor neque feugiat blandit. Ut vitae ipsum eget quam lacinia accumsan.
  ~ Etiam sed turpis ac ipsum condimentum fringilla. Maecenas magna.
  ~ Proin dapibus sapien vel ante. Aliquam erat volutpat. Pellentesque sagittis ligula eget metus.
  ~ Vestibulum commodo. Ut rhoncus gravida arcu.
  -->

<html>
<head>
    <meta charset="utf-8">
    <title>服务订单详情</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">
    <link rel="stylesheet" type="text/css" href="../addons/ching_leeing/template/mobile/default/static/css/weui.min.css">
    <link rel="stylesheet" type="text/css" href="../addons/ching_leeing/template/mobile/default/static/css/example.css"/>

    <style type="text/css">
        .left_icon {
            line-height: 46px;
            margin-left: 17px;
            color: #999;
            font-size: 18px;
        }

        .left_icon:before {
            content: " ";
            display: inline-block;
            -webkit-transform: rotate(45deg);
            transform: rotate(45deg);
            height: 10px;
            width: 10px;
            border-width: 0 0 2px 2px;
            border-color: #c7c7cc;
            border-style: solid;
            position: relative;
            /* top: 0px;
            position: absolute; */
            top: 0px;
            margin-right: 1px;
        }
    </style>
</head>
<body ontouchstart="">

<div id="div_weui_tab" class="weui_tab">

    <div style="height:46px;padding:0;" class="weui_navbar">
        <div onclick="window.location.href='{php echo mobileLink('orderhall');}&t='+new Date().getTime();"
             style="position: absolute;top: 0px;left:0px;display: inline-block;height:46px;line-height:46px;min-width:100px;">
            <a class="left_icon">返回抢单大厅</a>
        </div>
    </div>


    <div style="padding-bottom: 50px;padding-top: 46px;" class="weui_tab_bd">

        <div style="" class="container" id="container">


            <div class="cell">
                <div style="margin-bottom:15px;" class="bd">
                    <div class="weui_cells_title">订单信息<a href="javascript:addToBlackList('{$_W['openid']}');" style="float:right;color:#586c94">不想再收到Ta的订单?</a></div>
                    <div class="weui_cells">

                        <div class="weui_cell">
                            <div class="weui_cell_bd weui_cell_primary">
                                <p>服务类型</p>
                            </div>
                            <div class="weui_cell_ft">{$orderinfo['servicetypename']}</div>
                        </div>

                        <div class="weui_cell">
                            <div class="weui_cell_bd weui_cell_primary">
                                <p>服务酬金</p>
                            </div>
                            <div class="weui_cell_ft">
                                {$orderinfo['price']}元
                            </div>
                        </div>

                        <div class="weui_cell">
                            <div style="width:100%" class="weui_cell_hd">
                                <div style="position:absolute;dispaly:inline-block;float:left;">服务内容</div>
                                <div style="dispaly:inline-block;color:#888;margin-left:100px;text-align: right;float:right;">
                                    {$orderinfo['serviceabstract']}
                                </div>
                            </div>
                        </div>

                        <div class="weui_cell">
                            <div class="weui_cell_bd weui_cell_primary">
                                <p>服务时间</p>
                            </div>
                            <div class="weui_cell_ft">{php echo m('service')->getExpire($orderinfo['servicetime'])}</div>
                        </div>

                        <div class="weui_cell">
                            <div style="width:100%;min-height:24px;" class="weui_cell_hd">
                                <div style="position:absolute;dispaly:inline-block;float:left;">服务地址</div>
                                <div style="dispaly:inline-block;color:#888;margin-left:100px;text-align: right;float:right;">
                                    {$orderinfo['serviceschool']}<br/>{$orderinfo['address']}
                                </div>
                            </div>
                        </div>

                        <div class="weui_cell">
                            <div style="width:100%;min-height:24px;" class="weui_cell_hd">
                                <div style="position:absolute;dispaly:inline-block;float:left;">服务要求</div>
                                <div style="dispaly:inline-block;color:#888;margin-left:100px;text-align: right;float:right;">
                                    {$orderinfo['servicedetail']}
                                </div>
                            </div>
                        </div>

                        <div class="weui_cell">
                            <div class="weui_cell_bd weui_cell_primary">
                                <p>指定性别</p>
                            </div>
                            <div class="weui_cell_ft">
                                {if $orderinfo['sexrequire'] == 2}女生{/if}
                                {if $orderinfo['sexrequire'] == 1}男生{/if}
                                {if $orderinfo['sexrequire'] == 0}无{/if}
                            </div>
                        </div>

                    </div>

                    <div class="weui_cells" style="margin-top:11px;">
                        <div class="weui_cell">
                            <div class="weui_cell_bd weui_cell_primary">
                                <p>订单编号</p>
                            </div>
                            <div class="weui_cell_ft">{$orderinfo['ordersn']}</div>
                        </div>

                        <div class="weui_cell">
                            <div class="weui_cell_bd weui_cell_primary">
                                <p>下单时间</p>
                            </div>
                            <div class="weui_cell_ft">{php echo getTime($orderinfo['createtime'])}</div>
                        </div>
                        {if !empty($orderinfo['orderrectime'])}
                        <div class="weui_cell">
                            <div class="weui_cell_bd weui_cell_primary">
                                <p>接单时间</p>
                            </div>
                            <div class="weui_cell_ft">{php echo getTime($orderinfo['orderrectime'])}</div>
                        </div>
                        {/if}
                        {if !empty($orderinfo['orderstarttime'])}
                        <div class="weui_cell">
                            <div class="weui_cell_bd weui_cell_primary">
                                <p>服务开始时间</p>
                            </div>
                            <div class="weui_cell_ft">{php echo getTime($orderinfo['orderstarttime'])}</div>
                        </div>
                        {/if}
                        {if !empty($orderinfo['orderfinishtime'])}
                        <div class="weui_cell">
                            <div class="weui_cell_bd weui_cell_primary">
                                <p>服务完成时间</p>
                            </div>
                            <div class="weui_cell_ft">{php echo getTime($orderinfo['orderfinishtime'])}</div>
                        </div>
                        {/if}
                        {if !empty($orderinfo['finishtime'])}
                        <div class="weui_cell">
                            <div class="weui_cell_bd weui_cell_primary">
                                <p>订单完成时间</p>
                            </div>
                            <div class="weui_cell_ft">{php echo getTime($orderinfo['finishtime'])}</div>
                        </div>
                        {/if}
                    </div>

                </div>
            </div>


        </div>

    </div>

    <div id="bottom_tabbar" class="weui_tabbar" style="z-index:1;height:50px">
        {if $orderinfo['status'] == 0}
        <a onclick="takeOrder('{$orderinfo['ordersn']}');" style="width:100%;font-size: 18px;max-width:100%" class="btn-right-block btn-right-block-new  box-flex-c" id="order_submit">我要抢单</a>
        {/if}
        {if $orderinfo['status'] == -1}
        <a style="width:100%;font-size: 18px;max-width:100%" class="btn-right-block btn-right-block-new  box-flex-c" id="order_submit">订单取消</a>
        {/if}
    </div>


</div>

<!-- loading toast -->
<div id="loadingToast" class="weui_loading_toast" style="display:none;">
    <div class="weui_mask_transparent"></div>
    <div class="weui_toast">
        <div class="weui_loading">
            <div class="weui_loading_leaf weui_loading_leaf_0"></div>
            <div class="weui_loading_leaf weui_loading_leaf_1"></div>
            <div class="weui_loading_leaf weui_loading_leaf_2"></div>
            <div class="weui_loading_leaf weui_loading_leaf_3"></div>
            <div class="weui_loading_leaf weui_loading_leaf_4"></div>
            <div class="weui_loading_leaf weui_loading_leaf_5"></div>
            <div class="weui_loading_leaf weui_loading_leaf_6"></div>
            <div class="weui_loading_leaf weui_loading_leaf_7"></div>
            <div class="weui_loading_leaf weui_loading_leaf_8"></div>
            <div class="weui_loading_leaf weui_loading_leaf_9"></div>
            <div class="weui_loading_leaf weui_loading_leaf_10"></div>
            <div class="weui_loading_leaf weui_loading_leaf_11"></div>
        </div>
        <p id="weui_loading_tips" class="weui_toast_content">提交资料中</p>
    </div>
</div>

<!--BEGIN tips_dialog-->
<div class="weui_dialog_alert" id="commom_dialog_tips" style="z-index:10;display: none;">
    <div class="weui_mask"></div>
    <div class="weui_dialog">
        <div class="weui_dialog_hd"><strong class="weui_dialog_title">弹窗标题</strong></div>
        <div style="text-align: left;" class="weui_dialog_bd">弹窗内容，告知当前页面信息等</div>
        <div class="weui_dialog_ft">
            <a href="javascript:;" class="weui_btn_dialog primary">确定</a>
        </div>
    </div>
</div>

<!--BEGIN dialog-->
<div class="weui_dialog_confirm" id="dialog_confirm_tips" style="display: none;">
    <div class="weui_mask"></div>
    <div class="weui_dialog">
        <div class="weui_dialog_hd"><strong class="weui_dialog_title">抢单确认</strong></div>
        <div class="weui_dialog_bd">你确认要抢此订单?</div>
        <div class="weui_dialog_ft">
            <a href="javascript:$('#dialog_confirm_tips').hide();" class="weui_btn_dialog default">取消</a>
            <a href="javascript:;" class="weui_btn_dialog primary">确定</a>
        </div>
    </div>
</div>

<div class="weui_dialog_confirm" id="dialog_defriend_confirm_tips" style="display: none;">
    <div class="weui_mask"></div>
    <div class="weui_dialog">
        <div class="weui_dialog_hd"><strong class="weui_dialog_title">拉黑确认</strong></div>
        <div class="weui_dialog_bd">把对方加入黑名单后你将收不到对方的任何订单推送，确认操作吗?</div>
        <div class="weui_dialog_ft">
            <a href="javascript:$('#dialog_defriend_confirm_tips').hide();" class="weui_btn_dialog default">取消</a>
            <a href="javascript:;" class="weui_btn_dialog primary">确定</a>
        </div>
    </div>
</div>

</body>
<script src="../addons/ching_leeing/template/mobile/default/static/js/zepto.min.js"></script>
<script>

    function showCommomDialogTips(title, content) {
        $('#commom_dialog_tips .weui_dialog_title').text(title);
        $('#commom_dialog_tips .weui_dialog_bd').html(content);
        $('#commom_dialog_tips').show().on('click', '.weui_btn_dialog', function () {
            $('#commom_dialog_tips').off('click').hide();
        });
    }

    function addToBlackList(openid) {

        $('#dialog_defriend_confirm_tips').show().on('click', '.weui_btn_dialog.primary', function () {
            $('#dialog_defriend_confirm_tips').off('click').hide();
            $("#weui_loading_tips").html("正在设置");
            $('#loadingToast').show();

            $.getJSON('{php echo mobileLink('orderhall/addToBlackList')}&openid=' + openid, function (res) {
                $('#loadingToast').hide();
                if (res.code == 0) {
                    showCommomDialogTips("拉黑成功", "你已经成功将对方加入黑名单");
                } else {
                    showCommomDialogTips("拉黑失败", "请刷新页面重试!");
                }
            });
        });
    }

    function takeOrder(outTradeNo) {
        $('#dialog_confirm_tips').show().on('click', '.weui_btn_dialog.primary', function () {
            $('#dialog_confirm_tips').off('click').hide();
            $("#weui_loading_tips").html("拼命抢单中");
            $('#loadingToast').show();
            $.getJSON('{php echo mobileLink('orderhall/takeorder')}&outTradeNo=' + outTradeNo, function (res) {
                $('#loadingToast').hide();
                if (res.code == 0) {
                    $("#weui_loading_tips").html("抢单成功<br/>正在跳转");
                    $('#loadingToast').show();
                    window.location.href = "{php echo mobileLink('orderhall/getuserorderdetail')}&outTradeNo=" + outTradeNo;
                } else {
                    showCommomDialogTips(res.title, res.tips);
                }
            });

        });
    }

</script>
<script language='javascript'>
    $(function () {
        $.getJSON("{php echo mobileUrl('util/task')}");
    })
</script>
</html>